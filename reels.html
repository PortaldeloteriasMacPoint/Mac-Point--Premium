<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reels Profissional</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAO3As6jMMmENtzaK9zlDADbpS9UlNxx8o",
      authDomain: "mac-projeto-4e552.firebaseapp.com",
      projectId: "mac-projeto-4e552",
      storageBucket: "mac-projeto-4e552.appspot.com",
      messagingSenderId: "537330451519",
      appId: "1:537330451519:web:5a1b4c921119b5ee98e48a"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const categorias = {
      musicas: ["hTWKbfoikeg", "YjygaDPCtXE"],
      loterias: ["UceaB4D0jpo"],
      filmes: ["K4TOrB7at0Y"],
      humor: ["lXMskKTw3Bc"],
      animes: ["Wg9ax49c1Qk"],
      favoritos: [],
      novidades: ["gzMf4JmxSdY"],
      outros: ["tgbNymZ7vqY"]
    };

    let usuarioLogado = null;

    function login() {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider);
    }

    onAuthStateChanged(auth, user => {
      if (user) {
        usuarioLogado = user;
        document.getElementById("loginBtn").style.display = "none";
        renderCategoria("musicas");
      }
    });

    window.curtir = async function(videoId) {
      if (!usuarioLogado) return;
      const ref = doc(db, "curtidas", videoId);
      const snap = await getDoc(ref);
      if (snap.exists() && snap.data().usuarios.includes(usuarioLogado.uid)) {
        await updateDoc(ref, { usuarios: arrayRemove(usuarioLogado.uid) });
      } else {
        await setDoc(ref, { usuarios: arrayUnion(usuarioLogado.uid) }, { merge: true });
      }
      renderCategoria(categoriaAtual);
    }

    window.favoritar = async function(videoId) {
      if (!usuarioLogado) return;
      const ref = doc(db, "favoritos", usuarioLogado.uid);
      const snap = await getDoc(ref);
      if (snap.exists() && snap.data().videos.includes(videoId)) {
        await updateDoc(ref, { videos: arrayRemove(videoId) });
      } else {
        await setDoc(ref, { videos: arrayUnion(videoId) }, { merge: true });
      }
      if (categoriaAtual === 'favoritos') renderCategoria('favoritos');
    }

    window.compartilhar = function(videoId) {
      const url = `https://youtu.be/${videoId}`;
      if (navigator.share) {
        navigator.share({ title: "Veja este vÃ­deo", url });
      } else {
        prompt("Copie o link para compartilhar:", url);
      }
    }

    let categoriaAtual = "musicas";
    let favoritosUser = [];

    async function renderCategoria(categoria) {
      categoriaAtual = categoria;
      const container = document.getElementById("videos");
      container.innerHTML = "";
      let videos = categoria === "favoritos" && usuarioLogado ? (await getDoc(doc(db, "favoritos", usuarioLogado.uid))).data()?.videos || [] : categorias[categoria];
      for (const id of videos) {
        const ref = doc(db, "curtidas", id);
        const snap = await getDoc(ref);
        const likes = snap.exists() ? snap.data().usuarios.length : 0;
        const liked = snap.exists() && snap.data().usuarios.includes(usuarioLogado?.uid);
        const favSnap = usuarioLogado ? await getDoc(doc(db, "favoritos", usuarioLogado.uid)) : null;
        const favs = favSnap?.data()?.videos || [];
        const favorited = favs.includes(id);
        container.innerHTML += `
          <div class="card">
            <iframe src="https://www.youtube.com/embed/${id}?modestbranding=1&rel=0" allowfullscreen></iframe>
            <div class="acoes">
              <div class="like" onclick="curtir('${id}')">
                <svg viewBox="0 0 24 24" ${liked ? 'fill="red"' : ''}><path d="M12 21.35l-1.45-1.32C5.4 15.36..."/></svg>
                <span>${likes}</span>
              </div>
              <div class="fav" onclick="favoritar('${id}')">
                <svg viewBox="0 0 24 24" ${favorited ? 'fill="gold"' : ''}><path d="M12 17.27L18.18 21L16.54..."/></svg>
              </div>
              <div class="share" onclick="compartilhar('${id}')">
                <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3..."/></svg>
              </div>
            </div>
          </div>
        `;
      }
    }

    window.setCat = el => {
      document.querySelectorAll('.btns button').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
      renderCategoria(el.dataset.cat);
    }

    window.onload = () => {
      document.getElementById("loginBtn").onclick = login;
    }
  </script>
  <style>
    * { box-sizing: border-box; }
    body { background: black; color: white; margin: 0; font-family: sans-serif; }
    header { background: linear-gradient(to right, #355e3b, #4ca16b); padding: 1rem; text-align: center; border-radius: 0 0 12px 12px; }
    header h1 { font-size: 1.5rem; font-weight: bold; text-shadow: 0 0 10px #4ca16b; }
    .btns { overflow-x: auto; display: flex; gap: 10px; padding: 1rem; white-space: nowrap; }
    .btns button { padding: 10px 20px; background: none; border: 1px solid #355E3B; color: white; border-radius: 8px; cursor: pointer; }
    .btns button.active { background: #fff; color: #355E3B; font-weight: bold; }
    .card { background: #111; margin: 1rem auto; max-width: 400px; border-radius: 10px; overflow: hidden; box-shadow: 0 0 10px #355E3B; }
    .card iframe { width: 100%; height: 220px; border: none; }
    .acoes { display: flex; gap: 20px; padding: 10px; align-items: center; }
    .acoes div { display: flex; align-items: center; gap: 5px; cursor: pointer; }
    .acoes svg { width: 24px; height: 24px; fill: white; }
    #loginBtn { background: #355E3B; color: white; border: none; padding: 10px 20px; margin: 10px auto; display: block; border-radius: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸŽ¥ VÃ­deos Recomendados</h1>
  </header>
  <button id="loginBtn">Entrar com Google</button>
  <div class="btns">
    <button class="active" onclick="setCat(this)" data-cat="musicas">MÃºsicas</button>
    <button onclick="setCat(this)" data-cat="loterias">Loterias</button>
    <button onclick="setCat(this)" data-cat="filmes">Filmes</button>
    <button onclick="setCat(this)" data-cat="humor">Humor</button>
    <button onclick="setCat(this)" data-cat="animes">Animes</button>
    <button onclick="setCat(this)" data-cat="favoritos">Favoritos</button>
    <button onclick="setCat(this)" data-cat="novidades">Novidades</button>
    <button onclick="setCat(this)" data-cat="outros">Outros</button>
  </div>
  <main id="videos"></main>
</body>
</html>


